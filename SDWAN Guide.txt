CISCO SDWAN COMPONENTS

1. vManage was introduced as the management plane, where all Day 0, Day 1, and Day N functions will be performed, including WAN Edge
configuration, routing and control policies, troubleshooting, and monitoring.

2. vSmart is the brain of the Cisco SD WAN fabric and is responsible for calculating and deploying all control and data policies as well as handling
the distribution of encryption keys for data plane connectivity.

3. vBond makes up the orchestration plane and is responsible for authenticating components on the fabric in addition to distributing control and
management plane information to the WAN Edges. The vBond is the component that aids in discovery of the fabric for all other components (such
as when devices are behind NAT). The vBond then distributes the connectivity information for the vSmart and vManage to the WAN Edge.


4. vEdge handles the data plane is where user traffic will be routed and forwarded across the WAN. The data plane is similar to routers that would
be deployed in a traditional WAN, though in Cisco SD WAN, these are referred to as WAN Edges.

Each component authenticates each other and if successful, a Datagram Transport Layer Security (DTLS) tunnel is established. Separating the
control plane from the data and management plane, the protocol that vSmart uses to communicate all the WAN Edge routing is called Overlay
Management Protocol (OMP)


**************************************************
RESOURCE REQUIREMENTS

32GB RAM 
12 Core 

Network Adapter 1 : NAT (208.8.8.0/24)
Network Adapter 2 : VMNet15 (10.255.10.0/24)
Network Adapter 3 : VMNet16 (10.69.255.0/29)


**************************************************
SDWAN PROCEDURE

SDWAN Appliances Login
  User: admin
  Pass: C1sc0123
  
| Devices        | Ports |
| ---            | ---   |
| CLOUD          | 32902 |
| PKI SERVER     | 32913 |
|                |       |
| vManage        | 32897 |
| vSmart         | 32898 |
| vBond          | 32899 |
|                |       |
| vEdge-LUZON    | 32900 |
| vEdge-VISAYAS  | 32903 |
| vEdge-MINDANAO | 32904 |
|                |       |
| CSW-LUZON      | 32905 |
| CSW-VISAYAS    | 32906 |
| CSW-MINDANAO   | 32907 |


1. Set a host route for vManage GUI

!@cmd 
route add 10.69.255.13 mask 255.255.255.255 10.69.255.6


2. Boot Devices
- vManage	32897
- CLOUD		32902

Day0 Bootstrap Configuration
~~~
!@vManage
conf t
 system
  host-name Rivan-vManage
  site-id 10
  system-ip 10.1.10.2
  organization-name RIVANCORP
  vbond 172.16.10.3
  admin-tech-on-failure
 vpn 0
  int eth0
   ip add 172.16.10.2/29
   no shut
   tunnel-interface
    allow-service all
  ip route 0.0.0.0/0 172.16.10.6
 vpn 512
  int eth1
   ip add 10.69.255.13/30
   no shut
  ip route 0.0.0.0/0 10.69.255.14
  commit
  end
~~~


3. Access vManage GUI
*NOTE: It usually takes 10 MINUTES before vManage GUI is accessible

https://10.69.255.13:8443
  User: admin
  Pass: C1sc0123
  
~~~
!@vManage
request nms all status
show system status
~~~


4. Boot Devices
- vBond 	32899
- vSmart 	32898

~~~
!@vBond
conf t
 system
  host-name Rivan-vBond
  site-id 10
  system-ip 10.1.10.3
  organization-name RIVANCORP
  vbond 172.16.10.3 local vbond
  admin-tech-on-failure
 vpn 0
  int ge0/0
   ip add 172.16.10.3/29
   no shut
   tunnel-interface
    encapsulation ipsec
    allow-service all
  ip route 0.0.0.0/0 172.16.10.6
  commit
  end
~~~

~~~
!@vSmart
conf t
 system
  host-name Rivan-vSmart
  site-id 10
  system-ip 10.1.10.1
  organization-name RIVANCORP
  vbond 172.16.10.3
  admin-tech-on-failure
  vpn 0
   int eth0
    ip add 172.16.10.1/29
	no shut
	tunnel-interface
	 allow-service all
   ip route 0.0.0.0/0 172.16.10.6
   commit
   end
~~~


NOTE* Wait until the SDWAN Controllers are stable before turning on the vEdges




5. Boot Devices
- vEdge-LUZON 	32900
- vEdge-VISAYAS 32903


6. Configure BGP on CLOUD to establish connection with controllers

~~~
!@Cloud (BGP Config)
conf t
 int lo8
  ip add 8.8.8.8 255.255.255.255
 router bgp 1
  bgp log-neighbor-changes
  neighbor 192.168.20.1 remote-as 100
  neighbor 192.168.20.5 remote-as 100
  neighbor 192.168.20.9 remote-as 100
  address-family ipv4
   neighbor 192.168.20.1 activate
   neighbor 192.168.20.5 activate
   neighbor 192.168.20.9 activate
   neighbor 192.168.20.1 as-override
   neighbor 192.168.20.5 as-override
   neighbor 192.168.20.9 as-override
   network 8.8.8.8 mask 255.255.255.255
   network 192.168.20.0 mask 255.255.255.0
   network 172.16.10.0 mask 255.255.255.248
   network 10.69.255.0 mask 255.255.255.248
   end
~~~


~~~
!@vEdge-LUZON
show bgp routes
show bgp neighbors
~~~


7. Return to the vManage GUI then send the vEDGE list to all controllers

Configuration > Certificates > Send to Controllers


8. Configure Templates for SYSTEM

Configuration > Templates > Feature Templates > vEdge Cloud > System

Name: VE-SYSTEM
Desc: VE-SYSTEM

Console Baud Rate(bps): 9600

- Extra
GPS - Longitude & Latitude


9. Configure Templates for BANNER

Configuration > Templates > Feature Templates > vEdge Cloud > Banner

Name: VE-BANNER
Desc: VE-BANNER

Login Banner: Welcome to RIVANCORP
MOTD Banner: Property owned by RIVANCORP


10. Configure Templates for Interface IP address (VPN512)

Configuration > Templates > Feature Templates > vEdge Cloud > VPN Interface Ethernet

Name: VE-VPNINT-VPN512-ETH0
Desc: VE-VPNINT-VPN512-ETH0

Shutdown: No
Interface Name: eth0
Description: MANAGEMENT INTERFACE

IPv4Add: Default


11. Configure Templates for VPN0

Configuration > Templates > Feature Templates > vEdge Cloud > VPN

Name: VE-VPN0
Desc: VE-VPN0

VPN: 0
Name: TRANSPORT VPN

Ipv4 Route:
  Prefix: 0.0.0.0/0
  Gateway: NextHop
  Add Next Hop:
    Address: Device Specific


12. Configure Templates for VPN512

Configuration > Templates > Feature Templates > vEdge Cloud > VPN

Name: VE-VPN512
Desc: VE-VPN512

VPN: 512
Name: MANAGEMENT VPN


13. Configure Templates for Interface IP address (VPN0-G0/1)

Configuration > Templates > Feature Templates > vEdge Cloud > VPN Interface Ethernet

Name: VE-VPNINT-VPN0-GIG01
Desc: VE-VPNINT-VPN0-GIG01

Shutdown: No
Interface Name: ge0/1
Description: TRANSPORT INTERFACE

IPv4Add: Device Specific

Tunnel Interface: On
Color: BIZ-INTERNET

Allow Service: All, NETCONF, SSH, BGP
NAT: On


14. Configure Templates for Interface IP address (VPN0-G0/0)

Configuration > Templates > Feature Templates > vEdge Cloud > VPN Interface Ethernet

Name: VE-VPNINT-VPN0-GIG00
Desc: VE-VPNINT-VPN0-GIG00

Shutdown: No
Interface Name: ge0/0
Description: LAN INTERFACE

IPv4Add: Device Specific

Tunnel Interface: On
Color: Private1
Restrict: On
Allow Service: All, NETCONF, SSH, OSPF


15. Configure Templates for BGP

Configuration > Templates > Feature Templates > vEdge Cloud > BGP

Name: VE-BGP-VPN0
Desc: VE-BGP-VPN0

Shutdown: No
AS Number: Global 100

Neigbor:
  Address: 192.168.20.6
  Remote AS: 1
  Address Family: On
    Address Family: IPv4 Unicast
	Shutdown: No



DEVICE TEMPLATE

16. Configure Device Templates

Device Model: vEdge Cloud
Device Role: SDWAN Edge
Template Name: VE-TEMP
Desc: VE-TEMP

Basic Info:
  System: VE-SYSTEM
 
Transport & Management VPN:
  VPN0: VE-VPN0
  Add: 
    BGP: VE-BGP-VPN0
	VPN Interface: VE-VPNINT-VPN0-GIG00
	VPN Interface: VE-VPNINT-VPN0-GIG01
  
  VPN512: VE-VPN512
  VPN Interface: VE-VPNINT-VPN512-ETH1
  
  
DEPLOYMENT

17. Attatch Device Tempates to vEdge-LUZON & VISAYAS


18. Assign Correct Values Per device

PerDevice Edit:
  - VISAYAS
  - IPv4 (g0/1): 192.168.20.1/24
  - IPv4 (g0/0): 172.16.1.1/30
  - Hostname: vEDGE-VISAYAS
  - Latitude/Longitude: 3 deci
  - System IP: 10.1.25.1
  - Site ID: 25


19. Add Template for a user account

Configuration > Templates > Feature Templates > vEdge Cloud > AAA

Name: VE-ACC
Desc: VE-ACC

Auth Order: Local Only
Add User: admin C1sc0123
          rivan C1sc0123






*************
OSPF VPN OMP REDISTRIBUTION

!@CSW-LUZON 32905
conf t
 hostname CSW-LUZON
 enable secret pass
 service password-encryption
 no logging console
 no ip domain lookup
 username admin priv 15 secret pass
 line vty 0 14
  transport input all
  password pass
  login local
  exec-timeout 0 0
 int lo0
  ip add 1.1.1.1 255.255.255.255
  exit
 int g0/0
  no sw
  ip add 172.16.1.2 255.255.255.252
  no shut
 int g0/1
  no sw
  ip add 10.1.1.2 255.255.255.252
  no shut
 router ospf 1
  router-id 1.1.1.1
  network 172.16.1.0 0.0.0.3 area 0
  network 1.1.1.1 0.0.0.0 area 0
  network 10.1.1.0 0.0.0.3 area 0
  passive-interface lo0
  end


!@CSW-LUZON 32906
conf t
 hostname CSW-VISAYAS
 enable secret pass
 service password-encryption
 no logging console
 no ip domain lookup
 username admin priv 15 secret pass
 line vty 0 14
  transport input all
  password pass
  login local
  exec-timeout 0 0
 int lo0
  ip add 2.2.2.2 255.255.255.255
  exit
 int g0/0
  no sw
  ip add 172.16.5.2 255.255.255.252
  no shut
 int g0/1
  no sw
  ip add 10.1.2.2 255.255.255.252
  no shut
 router ospf 1
  router-id 2.2.2.2
  network 172.16.5.0 0.0.0.3 area 0
  network 2.2.2.2 0.0.0.0 area 0
  network 10.1.2.0 0.0.0.3 area 0
  passive-interface lo0
  end
  
  
  
  
ESTABLISH CONNECTION BETWEEN LUZON & VISAYAS

1. Configure Templates for VPN1

Configuration > Templates > Feature Templates > vEdge Cloud > VPN

Name: VE-VPN1
Desc: VE-VPN1

VPN: 1
NAME: DATA VPN

IPv4 Route: 
  Prefix: 0.0.0.0/0
  Gateway: VPN
  Enable VPN: On


2. Configure Templates VPN1 Interface [MODIFY]  - OPTIONAL

Configuration > Templates > Feature Templates > vEdge Cloud > MODIFY VE-VPNINT-VPN0GIG00

Name: Retain
Desc: Retain

Shutdown: No
Name: ge0/0
Description: LAN INTERFACE

Ipv4 Address: Device Specific


3. Configure Templates for OSPF 

Configuration > Templates > Feature Templates > vEdge Cloud > OSPF

Name: VE-OSPF-VPN1
Desc: VE-OSPF-VPN1

Redistribute:
  Protocol: omp

Area:
  Area Num: 0
  Interface:
    Interface Name: ge0/0
	
	ADD x2

Advance:
  Originate: On
  Always: On



4. Update VE-TEMP (Device Template)

Service VPN:
  Add VPN: VE-VPN1
    OSPF: VE-OSPF-VPN1
	VPN Interface: VE-VPNINT-VPN0-GIG00

Remove GIG00 From VPN 0

Assign G0/0 With the IP based on the topology



****************
ONBOARD Mindanao

1. Configure CSR-MINDANAO

!@CSW-MINDANAO 32907
conf t
 hostname CSW-MINDANAO
 enable secret pass
 service password-encryption
 no logging console
 no ip domain lookup
 username admin priv 15 secret pass
 line vty 0 14
  transport input all
  password pass
  login local
  exec-timeout 0 0
 int lo0
  ip add 3.3.3.3 255.255.255.255
  exit
 int g0/0
  no sw
  ip add 172.16.9.2 255.255.255.252
  no shut
 int g0/1
  no sw
  ip add 10.1.3.2 255.255.255.252
  no shut
 router ospf 1
  router-id 3.3.3.3
  network 172.16.9.0 0.0.0.3 area 0
  network 3.3.3.3 0.0.0.0 area 0
  network 10.1.3.0 0.0.0.3 area 0
  passive-interface lo0
  end
